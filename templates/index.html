<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>

<body>

    <h1 id="dateDisplay" style="text-align: center; margin: auto; padding-top: 50px; font-size: x-large;"></h1>


    <main class="center-container">
        <div class="dropdown">
            <button id="dropdownButton" style="background-color: transparent; border-color: transparent;">
                .<div id="pixelStarContainer" style="margin-left: 15px;"></div></button>
            <div id="dropdownContent" class="dropdown-content">

                <form id="tracker_form" action="/insert_task" method="post" style="font-size: medium;">
                    <input type="checkbox" id="Exercise" name="Exercise" value="True"> Exercise <br>

                    <input type="checkbox" id="Book" name="Book" value="True"> Book <br>

                    <input type="checkbox" id="Skill" name="Skill" value="True"> 30 min rule <br>

                    <input type="checkbox" id="DSA" name="DSA" value="True"> 1 Q <br>

                    <input type="checkbox" id="Special" name="Special" value="True"> Special <br>

                    <button class="btn" type="submit">Check Out</button>
                </form>
            </div>

        </div>
    </main>



    <h1 id="Total_Amount" style="text-align: center; margin: auto; padding-top: 50px;">543</h1><br>

    <div class="expense_tracker">
        <h3>New transaction</h3>
        <hr>

        <form id="expense_tracker_form" action="/insert_expense" method="post" style="font-size: 10px;">

            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="radio" id="necessary" name="type" value="necessary">
                <label for="necessary">Necessary</label>

                <input type="radio" id="optional" name="type" value="optional">
                <label for="optional">Optional</label>
            </div>

            <div>
                <label for="description">Description </label>
                <input type="text" id="description" name="description" /><br>
            </div>

            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="radio" id="UPI" name="mode" value="UPI">
                <label for="UPI">UPI</label>

                <input type="radio" id="Cash" name="mode" value="Cash">
                <label for="Cash">Cash</label>
            </div>

            <div>
                <label for="price">Amount</label>
                <input type="number" id="price" name="price" placeholder="Enter amount..." />
            </div>

            <button class="btn" type="submit" >Add transaction</button><br>
            <div id="successMessage"></div>


        </form>


    </div>

    <script>
        async function submitTasks(event) {

            event.preventDefault();
            var count = 0
            
            count = await fetch('/insert_task', {
                method: "POST",
                body: new FormData(document.getElementById('tracker_form')),
            })
                .then(response => response.json())
                .then(response => response.star_count)
                .catch(error => {
                    console.error('Error:', error);
                    return 0;
                });

            addPixelStars(count)
        }

        async function submitExpenses(event){
            event.preventDefault()
            var response_message = ""

            // Get form values
            var type = document.querySelector('input[name="type"]:checked').value;
            var description = document.getElementById("description").value;
            var mode = document.querySelector('input[name="mode"]:checked').value;
            var price = document.getElementById("price").value;

            // Create FormData object
            var formdata = new FormData();
            formdata.append("type", type);
            formdata.append("description", description);
            formdata.append("mode", mode);
            formdata.append("price", price);

            response_message = await fetch("/insert_expense", {
                method: "POST",
                body: formdata,
            })
                .then(response => response.json())
                .then(response => response.message)
                .catch(error => {
                    console.error('Error:', error);
                    return 0;
                });

            var successMessage = document.getElementById('successMessage');
            console.log(response_message)
            if (successMessage) 
            {
                successMessage.textContent = response_message; // Assuming the server sends a 'message' key
                successMessage.style.color = 'green';
                document.getElementById('expense_tracker_form').reset(); // Assuming your form has an id of 'expenseForm'
                } 
                else {
                console.error('Error: Element with ID "successMessage" not found');
            }
        }

        document.getElementById('tracker_form').addEventListener('submit', submitTasks);
        document.getElementById('expense_tracker_form').addEventListener('submit', submitExpenses);
    </script>

    <script src="/static/script.js"></script>
</body>

</html>